script(src="/templates/post/post.js")

.new
  form
    input(type="text" placeholder="Type here...")
  script.
    socket.on('post', function(response){
      var locals = {};
      locals.post = response;
      locals.moment = moment;
      $(anonymous(locals)).appendTo('.main .posts')[0].scrollIntoView();

      $('.post .distance').text(function(){
        var postTime = moment($(this).data('timestamp'));
        if (postTime.isSame(moment(), 'day') && postTime.fromNow() !== $(this).text()) {
          return postTime.fromNow();
        }
      });
    });

    $('.new form').submit(function(event){
      var $input = $(this).find('input');

      if ($input.val() === "") return false;

      event.preventDefault();
      socket.emit('post', {
        body: $input.val(),
        created_at: new Date(),
        user: {
          id: forum.constants.user.id,
          name: forum.constants.user.name
        }
      });
      $input.val('');
    });
